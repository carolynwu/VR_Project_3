<html>
  <head>
	<meta charset="utf-8">
	<title>CS 4331-002: Project 3 by Xujia Wu and Simon Woldemichael</title>
	<meta charset="UTF-8">
	<meta name="description" content="CS 4331-002 Special Topics in CS: Virtual Reality - Project 3">
	<meta name="keywords" content="Virtual,Reality,Project">
	<meta name="author" content="Xujia Wu and Simon Woldemichael">
	
	<!-- a-frame-materials keyboard has only been tested with A-Frame v0.6.1 -->
	<script src="https://aframe.io/releases/0.6.1/aframe.min.js"></script>
	<!--<script src="https://aframe.io/releases/0.7.0/aframe.min.js"></script>-->
	
	<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.4.5/socket.io.min.js"></script>
	<script src="/easyrtc/easyrtc.js"></script>
	<script src="https://unpkg.com/networked-aframe/dist/networked-aframe.min.js"></script>
	<script src="https://unpkg.com/aframe-randomizer-components@^3.0.1/dist/aframe-randomizer-components.min.js"></script>
	
	<script src="https://rawgit.com/mayognaise/aframe-mouse-cursor-component/master/dist/aframe-mouse-cursor-component.min.js"></script>
	<script src="https://cdn.rawgit.com/zcanter/aframe-gradient-sky/master/dist/gradientsky.min.js"></script>
	<script src="https://cdn.rawgit.com/etiennepinchon/aframe-material/master/dist/aframe-material.min.js"></script>
	
	<!-- Helper script to ensure that all new players that join the scene are spawned within the same place -->
	<script src="/js/spawn-in-circle.component.js"></script>

	<!-- Config -->
	<script src="api/config.js"></script>
	
	<!-- Depenendices for YouTube -->
	<script src="api/youtube.js"></script>
	<script src="https://apis.google.com/js/client.js"></script>

	<!-- Globals for simplicity -->
	<script type="text/javascript">
		AFRAME.ASSETS_PATH = "./assets";
		var search_query = '';
		var make_youtube_query = false;
	</script>
	
				
	<script type="text/javascript">
	function styleKeyboard(){
		// Update the keyboard's settings since it allows outline changes
		var key_styler = document.querySelector("a-keyboard");
		key_styler.setAttribute('position', {x: -2.15, y: 0.015, z: -2.00});
		key_styler.setAttribute('scale', {x: 3.519, y: 3.519, z: 3.519});
	}
	</script>

</head>
	<body>
		<!-- Begin A-Scene -->
		<a-scene networked-scene="room: dev; debug: true; adapter: wseasyrtc;">
			<!-- Define assets -->
			<a-assets>
				<img id="grid" src="https://i.imgur.com/25P1geh.png" crossorigin="anonymous" />

				<!-- Templates -->
				<!-- Avatar. Must be HTML <template> tagged -->
				<template id="avatar-template">
					<a-entity class="avatar">
						<a-sphere class="head" color="#ffffff" scale="0.45 0.5 0.4"></a-sphere>
						<a-entity class="face" position="0 0.05 0">
							<a-sphere class="eye" color="#efefef" position="0.16 0.1 -0.35" scale="0.12 0.12 0.12">
								<a-sphere class="pupil" color="#000" position="0 0 -1" scale="0.2 0.2 0.2"></a-sphere>
							</a-sphere>
							<a-sphere class="eye" color="#efefef" position="-0.16 0.1 -0.35" scale="0.12 0.12 0.12">
								<a-sphere class="pupil" color="#000" position="0 0 -1" scale="0.2 0.2 0.2"></a-sphere>
							</a-sphere>
						</a-entity>
					</a-entity>
				</template>
				
			</a-assets>
			
			<!-- Laser controls entity for WebVR compatible headsets? -->
			<a-entity laser-controls="hand: right"></a-entity>
			
			<!-- Setup skybox gradient -->
			<a-gradient-sky material="shader: gradient; topColor: 0 0 204; bottomColor: 0 153 255;"></a-gradient-sky>

			<!--Define a raycaster to track the position of the mouse (i.e. where the user is looking)-->
			<a-camera raycaster="far: 150; objects: .intersectable" look-controls-enabled wasd-controls-enabled mouse-cursor></a-camera>
			
			<!-- Make keyboard and display an input box for search query -->
			<a-keyboard></a-keyboard>
			
			<!-- When the user clicks the input box, the keyboard will be scaled and repositioned. Unable to do this with attribute tags for some reason -->
			<a-input onClick="styleKeyboard()" position="-.65 1.235 -3.35" rotation="-21.4 0 0" placeholder="Input video search query" color="black" width="1" scale="2.163 2.163 2.163"></a-input>
			
			<!-- Video selection interface -->
			<a-entity id="interface-title-1" text="value:YouTube Video Search; color:#E52D27; shader: msdf; font:mozillavr;" scale="15 15 15" position="4.571 5.134 -3.42"></a-entity>
			<!-- Note: Since only three videos are being shown, the last two of every attribute have visible="false" -->
			<a-rounded position="-1.18 1.567 -3.44" width="4" height="3.1" radius="0.05" rotation="0 0 0" scale="0.816 0.816 0.816" >
			<a-form>
				<a-button position=-1.56 -0.32 2.469" rotation="0 45 0" name="help" value="Need Help?" color="#FFFFFF"></a-button>
				
				<!-- Video Thumbnails -->
				<a-image id="image1" position=".559 2.573 .010" material="shader: standard"></a-image>
				<a-image id="image2" position=".552 1.546 .008" material="shader: standard"></a-image>
				<a-image id="image3" position=".548 .535 .006" material="shader: standard"></a-image>
				<a-image id="image4" position="" visible="false" material="shader: standard"></a-image>
				<a-image id="image5" position="" visible="false" material="shader: standard"></a-image>
				
				<!-- Video Titles -->
				<a-text id="title1" color="black" font="kelsonsans" wrap-count="30" position="1.170 2.9 0" width="2"></a-text>
				<a-text id="title2" color="black" font="kelsonsans" wrap-count="30" position="1.159 1.915 0" width="2"></a-text>
				<a-text id="title3" color="black" font="kelsonsans" wrap-count="30" position="1.161 .830 0" width="2"></a-text>
				<a-text id="title4" visible="false"></a-text>
				<a-text id="title5" visible="false"></a-text>
				
				<!-- Video Descriptions -->
				<a-text id="description1" color="black" font="kelsonsans" wrap-count="40" position="1.170 2.502 0" width="2"></a-text>
				<a-text id="description2" color="black" font="kelsonsans" wrap-count="40" position="1.159 1.441 0" width="2"></a-text>
				<a-text id="description3" color="black" font="kelsonsans" wrap-count="40" position="1.161 .384 0" width="2"></a-text>
				<a-text id="description4" visible="false"></a-text>
				<a-text id="description5" visible="false"></a-text>
			</a-form>
			</a-rounded>

			<!-- Toast pop-up -->
			<a-toast duration="100000" autoshow="false" font="kelsonsans" message="Click the search box!" action="Got it"></a-toast>
			
			<!-- Ground plane -->
			<a-entity position="0 0 0" geometry="primitive: plane; width: 10000; height: 10000;" rotation="-90 0 0" material="src: #grid; repeat: 10000 10000; transparent: true; metalness:0.6;"></a-entity>
			
			<!-- Begin networking setup for RTC -->
			<a-entity id="player" networked="template:#avatar-template;attachTemplateToLocal:false;" camera="userHeight: 1.6" spawn-in-circle="radius:3" wasd-controls look-controls>
				<a-sphere class="head" visible="false" random-color></a-sphere>
			</a-entity>

		</a-scene>

		<!-- This script and all other utilities should be moved -->
		<script>
		console.log("Networking player model schema...");
		// Player model schema
		NAF.schemas.add({
			template: '#avatar-template',
			components: [
			'position',
			'rotation',
			{
				selector: '.head',
				component: 'material',
				property: 'color'
			}
			]
		});
		
		// Called by Networked-Aframe when connected to server
		function onConnect () {
			console.log("onConnect", new Date());
		}
		</script>
		
		<!-- This script and all other utilities should be moved -->
		<script type="text/javascript">
		let toast = document.querySelector('a-toast');
		let input_box = document.querySelector('a-input');
		let keyboard = document.querySelector('a-keyboard');
		let help_button = document.querySelector('a-button');
		
		// Show toast pop-up when button is clicked, and close when the toast is clicked
		toast.addEventListener('actionclick', ()=>{
			toast.hide();
		})
		

		// Show a help message after clicking the button
        help_button.addEventListener('click', ()=> {
			toast.setAttribute('scale', {x:1.5, y:1.5, z:1.5});
			toast.setAttribute('position', {x:-1.49, y:.368, z:-1.6}); 
			toast.show();
        })
		
		// Track keyboard input
		keyboard.addEventListener('input', (e)=>{
			search_query += e.detail;
			//console.log(search_query);
		});

		// When the user presses the enter key
		keyboard.addEventListener('enter', (e)=>{
			console.log("Enter key pressed!")
		});
		
		// When the user presses backspace
		keyboard.addEventListener('backspace', (e)=>{
			input_box.value = input_box.value.substring(0, input_box.value.length - 1);
			search_query = search_query.substring(0, search_query.length - 1);
			console.log(input_box.value);
			console.log(search_query);
		});

		// Listen for keyboard close
		keyboard.addEventListener('dismiss', (e)=>{
			console.log("Dismiss: ", e);
			keyboard.dismiss();
			make_youtube_query = true;
			call_youtube_api(make_youtube_query); // Query YouTube's API
			search_query = '' // Reset query for the next search
		});
		</script>
	
	</body>
</html>
