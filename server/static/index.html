<html>
  <head>
	<meta charset="utf-8">
	<title>CS 4331-002: Project 3 by Xujia Wu and Simon Woldemichael</title>
	<meta charset="UTF-8">
	<meta name="description" content="CS 4331-002 Special Topics in CS: Virtual Reality - Project 3">
	<meta name="keywords" content="Virtual,Reality,Project">
	<meta name="author" content="Xujia Wu and Simon Woldemichael">
	
	<!--script src="https://aframe.io/releases/0.7.0/aframe.min.js"></script-->
	<!--a-frame-materials keyboard has only been tested with A-Frame v0.6.1-->
	<script src="https://aframe.io/releases/0.6.1/aframe.min.js"></script>
	<script src="/build.js"></script>
	<script>window.NAF || document.write('<script src="https://unpkg.com/networked-aframe/dist/networked-aframe.min.js">\x3C/script>')</script>
	<script src="https://unpkg.com/aframe-randomizer-components@^3.0.1/dist/aframe-randomizer-components.min.js"></script>
	<!--script src="https://unpkg.com/aframe-particle-system-component@1.0.5/dist/aframe-particle-system-component.min.js"></script>-->
	

	<script src="https://rawgit.com/mayognaise/aframe-mouse-cursor-component/master/dist/aframe-mouse-cursor-component.min.js"></script>
	<script src="https://cdn.rawgit.com/zcanter/aframe-gradient-sky/master/dist/gradientsky.min.js"></script>
	<script src="https://cdn.rawgit.com/etiennepinchon/aframe-material/master/dist/aframe-material.min.js"></script>
	
	<script src="/js/spawn-in-circle.component.js"></script>
	<script type="text/javascript">
		AFRAME.ASSETS_PATH = "./assets";
		var search_query = '';
	</script>
	
</head>
	<body>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.4.5/socket.io.min.js"></script>
		<script src="/easyrtc/easyrtc.js"></script>
		
		<!--Begin A-Scene-->
		<a-scene networked-scene="room: dev; debug: true; adapter: wseasyrtc;">
			<!--Define assets-->
			<a-assets>
				<img id="grid" src="https://img.gs/bbdkhfbzkk/stretch/https://i.imgur.com/25P1geh.png" crossorigin="anonymous">
				<img id="sky" src="http://i.imgur.com/WqlqEkq.jpg" crossorigin="anonymous" />

				<!-- Templates -->
				<!-- Avatar. Must be HTML <template> tagged-->
				<template id="avatar-template">
					<a-entity class="avatar">
						<a-sphere class="head" color="#ffffff" scale="0.45 0.5 0.4"></a-sphere>
						<a-entity class="face" position="0 0.05 0">
							<a-sphere class="eye" color="#efefef" position="0.16 0.1 -0.35" scale="0.12 0.12 0.12">
								<a-sphere class="pupil" color="#000" position="0 0 -1" scale="0.2 0.2 0.2"></a-sphere>
							</a-sphere>
							<a-sphere class="eye" color="#efefef" position="-0.16 0.1 -0.35" scale="0.12 0.12 0.12">
								<a-sphere class="pupil" color="#000" position="0 0 -1" scale="0.2 0.2 0.2"></a-sphere>
							</a-sphere>
						</a-entity>
					</a-entity>
				</template>
			</a-assets>
			
			<!--Laser controls entity for WebVR compatible headsets?-->
			<a-entity laser-controls="hand: right"></a-entity>
			
			<!-- Setup skybox gradient-->
			<a-gradient-sky material="shader: gradient; topColor: 0 0 204; bottomColor: 0 153 255;"></a-gradient-sky>

			<!--Define a raycaster to track the position of the mouse (i.e. where the user is looking)-->
			<a-camera raycaster="far: 150; objects: .intersectable" look-controls-enabled wasd-controls-enabled mouse-cursor></a-camera>

			<!-- Make keyboard and display an input box for search query -->
			<a-keyboard></a-keyboard>
			<a-input position="-.183 1.085 -0.853" placeholder="Search" color="black" width="1"></a-input>

			<!-- Help display form-->
			<a-rounded position="0.5 0.5 -2.5" width="4" height="3.1" radius="0.05" rotation="0 -20 0" scale="0.3 0.3 0.3">
			<a-form>
				<a-button position="0.2 0.8 0" name="stuff" value="Click me" type="raised"></a-button>
			</a-form>
			</a-rounded>

			<!--Toast pop-up -->
			<a-toast message="This is a toast" action="Got it"></a-toast>
			
			<!--Begin networking setup for RTC-->
			<a-entity id="player" networked="template:#avatar-template;attachTemplateToLocal:false;" camera="userHeight: 1.6" spawn-in-circle="radius:3" wasd-controls look-controls>
				<a-sphere class="head" visible="false" random-color></a-sphere>
			</a-entity>
			
			<!--This is commented it out because we're using a gradient "sky" and ground plane-->
			<!--<a-entity position="0 0 0" geometry="primitive: plane; width: 10000; height: 10000;" rotation="-90 0 0" material="src: #grid; repeat: 10000 10000; transparent: true; metalness:0.6; roughness: 0.4; sphericalEnvMap: #sky;"></a-entity>-->
			<!--a-sky src="#sky" rotation="0 -90 0"></a-sky>-->
			<!--<a-entity id="particles" particle-system="preset: snow"></a-entity>-->

			<!--Lighting-->
			<a-entity light="color: #ccccff; intensity: 1; type: ambient;" visible=""></a-entity>
			<a-entity light="color: #ffaaff; intensity: 1.5" position="5 5 5"></a-entity>
		</a-scene>

		<!-- This script and all other utilities should be moved--->
		<script>
		// Define custom schema for syncing avatar color, set by random-color
		NAF.schemas.add({
			template: '#avatar-template',
			components: [
			'position',
			'rotation',
			{
				selector: '.head',
				component: 'material',
				property: 'color'
			}
			]
		});

		// Called by Networked-Aframe when connected to server
		function onConnect () {
			console.log("onConnect", new Date());
		}

		// On mobile remove elements that are resource heavy
		var isMobile = AFRAME.utils.device.isMobile();

		if (isMobile) {
			var particles = document.getElementById('particles');
			particles.parentNode.removeChild(particles);
		}
		</script>
		
		<!-- This script and all other utilities should be moved--->
		<script type="text/javascript">
		let button = document.querySelector('a-button');
		let toast = document.querySelector('a-toast');
		let input_box = document.querySelector('a-input');
		
		// Show toast pop-up when button is clicked, and close when the toast is clicked
		toast.addEventListener('actionclick', ()=>{
		toast.hide();
		})
		button.addEventListener('click', ()=> {
		toast.show();
		})
		

		let keyboard = document.querySelector("a-keyboard");
		// show the keyboard after clicking the input
		
        button.addEventListener('click', ()=> {
            keyboard.open();
        })

        // Track keyboard input
		keyboard.addEventListener('input', (e)=>{
			search_query += e.detail;
			console.log(search_query);
		});


		// Listen for keyboard close
		keyboard.addEventListener('dismiss', (e)=>{
			console.log("Dismiss: ", e);
			keyboard.dismiss();
			input_box.value = '' // Clear the input box value
			/*Make the Youtube query here*/
			/*Call function to play video*/
			search_query = '' // Reset query for the next search
		});
		</script>
	</body>
</html>
